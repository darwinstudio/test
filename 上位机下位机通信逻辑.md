# 上位机下位机通信逻辑

~~~mermaid
graph TD
start-->下位机上报故障码;
start[上电]-->下位机上报机器复位完成-->enable[上位机发送使能命令];
enable-->单步使能-->上位机发送单步命令-->下位机执行完毕后回复;
enable-->检测使能-->下位机上报进程正在移样-->下位机上报进程正在推样-->下位机上报扫码信息-->notefy[上位机发送检测项目通知]-->下位机上报进程正在稀释-->下位机上报进程正在搅拌-->下位机上报进程沉淀等待-->下位机上报进程正在取样;

notefy-->psjk1[下位机上报进程:试剂卡通道一正在推卡到滴样位置]-->sjk2[下位机上报进程正在试剂卡滴样]-->如果是双通道,下位机在这里上报进程正在清洗-->wxjzt[下位机询问上位机试剂卡相机状态]-->上位机回复试剂卡相机状态-->试剂卡相机可用-->下位机上报进程正在推卡到试剂卡拍照位置-->下位机请求上位机试剂卡拍照-->上位机发送补光灯控制命令-->下位机执行后应答;
psjk1-->下位机上报试剂卡仓一空-->上位机发送试剂卡仓一补充完毕-->sjk2;
sjk2-->psjk2[下位机上报进程:试剂卡通道二正在推卡到滴样位置];
subgraph db2[双通道]
psjk2-->sjk2;
end
下位机上报进程正在推样-->下位机上报进程正在清台;
检测使能-->下位机上报移样台空;
notefy-->下位机上报进程正在推计数板到滴样位置-->下位机上报进程正在进行计数板滴样-->下位机上报计数板滴样完成-->如果试剂卡是单通道,在这里下位机上报进程正在清洗-->上位机控制镜检电机进行镜检拍照-->下位机执行完毕后应答上位机的控制命令-->上位机发送镜检拍照完成;
~~~
